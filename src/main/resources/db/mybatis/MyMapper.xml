<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MyMapper">
    <select id="getUsersNameNotNull" resultType="User">
        select * from USER
        <if test="username != null">
            where name = #{username}
        </if>
        limit #{offset}, #{limit}
    </select>
    <select id="getUserCount" resultType="int">
        select count(*) from USER
        <if test="username != null">
            where name = #{username}
        </if>
    </select>
    <insert id="batchInsertUsers">
        insert into user(name, tel, address) values
        <foreach item="item" collection="users" separator=",">
            (#{item.name},#{item.tel},#{item.address})
        </foreach>
    </insert>
    <update id="updateUser">
        update user
        <set>
            <if test="item.name != null">
                name = #{item.name},
            </if>
            <if test="item.address != null">
                address = #{item.address},
            </if>
            <if test="item.tel != null">
                tel = #{item.tel}
            </if>
        </set>
        where id = #{item.id}
    </update>

    <select id="getInnerJoinOrders" resultMap="orderResult">
        select o.id                          as order_id,
               u.id                          as user_id,
               u.name                        as user_name,
               g.name                        as goods_name,
               g.price                       as goods_price,
               o.GOODS_NUM                   as goods_num,
               (o.goods_price * o.GOODS_NUM) as total_price
        from "ORDER" o
                 inner join GOODS g on o.GOODS_ID = g.ID
                 inner join USER u on o.USER_ID = u.ID
        where g.NAME is not null
          and u.NAME is not null
    </select>

    <resultMap id="orderResult" type="Order">
        <id property="id" column="order_id"/>
        <result property="totalPrice" column="total_price"/>
        <association property="user" javaType="User" columnPrefix="user_">
            <result property="id" column="id"/>
            <result property="name" column="name"/>
        </association>
        <association property="goods" javaType="Goods" columnPrefix="goods_">
            <result property="name" column="name"/>
            <result property="price" column="price"/>
        </association>
    </resultMap>
</mapper>
